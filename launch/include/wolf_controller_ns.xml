<?xml version="1.0" ?>
<launch>

    <!-- Robot related arguments -->
    <arg name="robot_model"        default="spot"/>
    <arg name="robot_name"         default=""/>
    <arg name="sensors"            default="false" />
    <arg name="period"             default="0.001" />
    <arg name="arm_name"           default="" />
    <arg name="max_vel_x"          default="0.7"/>
    <arg name="max_vel_y"          default="0.5"/>
    <arg name="max_vel_z"          default="0.5"/>
    <arg name="max_vel_yaw"        default="0.5"/>

    <!-- Input device argument -->
    <arg name="input_device" default="keyboard"/>

    <!-- GUI related arguments -->
    <arg name="gazebo_gui"      default="true" />
    <arg name="plotjuggler_gui" default="false" />
    <arg name="rviz_gui"        default="false" />
    <arg name="rqt_gui"         default="true" />
    <arg name="plot_node_gui"   default="false" />
    <arg name="full_gui"        default="false" />

    <!-- Odometry arguments -->
    <arg name="publish_odom_msg" default="true"/>
    <arg name="publish_odom_tf"  default="true"/>

    <!-- Export some params to the param server -->
    <param name="wolf_controller/period"        value="$(arg period)"/>
    <param name="wolf_controller/input_device"  value="$(arg input_device)"/>
    <param name="robot_name"                    value="$(arg robot_name)"  type="str"  />
    <param name="robot_model"                   value="$(arg robot_model)" type="str"  />

    <!-- Export the tf_prefix -->
    <group if="$(eval robot_name != '/')">
        <param name="tf_prefix" value="$(arg robot_name)"/>
    </group>
    <group if="$(eval robot_name == '/')">
        <param name="tf_prefix" value=""/>
    </group>

    <!-- Joy node -->
    <node pkg="joy" type="joy_node"     name="joy_node" ns="wolf_controller" if="$(eval arg('input_device') == 'ps3' or arg('input_device') == 'xbox')">
         <param name="autorepeat_rate " value="500" />
         <param name="deadzone"         value="0.1"/>
    </node>
    <!-- Space Mouse Joy node -->
    <include file="$(find spacenav_node)/launch/classic.launch" if="$(eval arg('input_device') == 'spacemouse')"/>
    <!-- Keyboard node -->
    <group if="$(eval input_device == 'keyboard')">
         <node pkg="wolf_controller_ros" type="keyboard_node" name="keyboard_node" output="screen" respawn="true"/>
    </group>

    <!-- Loading joint states publisher configurations from YAML file to parameter server -->
    <rosparam file="$(find wolf_controller_ros)/params/joint_state_publisher.yaml" command="load"/>

    <!-- Load controller config -->
    <group if="$(eval arm_name != '')">
          <rosparam command="load" file="$(eval find(arg('robot_model')+'_description')+'/params/'+arg('robot_model')+'_'+arg('arm_name')+'_params.yaml')" subst_value="true"/>
    </group>
    <group if="$(eval arm_name == '')">
          <rosparam command="load" file="$(eval find(arg('robot_model')+'_description')+'/params/'+arg('robot_model')+'_params.yaml')" subst_value="true"/>
    </group>

    <!-- Spawn wolf controller and joint state publisher -->
    <include file="$(find wolf_controller_ros)/launch/wolf_controller_spawn.launch">
          <arg name="extra_controllers" value="joint_state_publisher" />
    </include>

    <!-- Convert joint states to TF transforms for rviz, etc -->
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" respawn="false" output="log">
        <remap from="/joint_states" to="/$(arg robot_name)/joint_states"/>
    </node>

    <!-- GUI nodes -->
    <!-- plot_node -->
    <node name="wolf_plot_node" pkg="wolf_controller_ros" type="plot_node" output="screen"
          if="$(eval arg('full_gui') or arg('plot_node_gui'))"/>
    <!-- plotjuggler -->
    <node name="wolf_plotjuggler" pkg="plotjuggler" type="plotjuggler"
          args="$(eval '--layout '+find('wolf_controller_ros')+'/plotjuggler/controller.xml --nosplash')"
          if="$(eval arg('full_gui') or arg('plotjuggler_gui'))"/>
    <!-- rviz -->
    <node name="wolf_rviz" pkg="rviz" type="rviz"
          args="$(eval '-d '+find('wolf_controller_ros')+'/rviz/controller.rviz')"
          if="$(eval arg('full_gui')or arg('rviz_gui'))"/>
    <!-- rqt_reconfigure -->
    <node name="wolf_gui" pkg="rqt_reconfigure" type="rqt_reconfigure"
          if="$(eval arg('full_gui') or arg('rqt_gui'))"/>


</launch>
